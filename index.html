<!doctype>
<head>
    <link type="text/css" rel="stylesheet" href="http://code.shutterstock.com/rickshaw/rickshaw.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>

    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script src="http://code.shutterstock.com/rickshaw/rickshaw.min.js"></script>
</head>
<body>

<style>
#chart_container {
    display: inline-block;
    font-family: Arial, Helvetica, sans-serif;
}
#chart {
    float: left;
}
#legend {
    float: left;
    margin-left: 15px;
}
#offset_form {
    float: left;
    margin: 2em 0 0 15px;
    font-size: 13px;
}
#y_axis {
    float: left;
    width: 40px;
}
</style>

<div id="chart_container">
    <div id="y_axis"></div>
    <div id="chart"></div>
    <div id="legend"></div>
    <div id="slider"></div>
    <form id="offset_form" class="toggler">
        <input type="radio" name="offset" id="lines" value="lines" checked>
        <label class="lines" for="lines">lines</label><br>
        <input type="radio" name="offset" id="stack" value="zero">
        <label class="stack" for="stack">stack</label>
    </form>
</div>

<script>
var palette = new Rickshaw.Color.Palette();

//
// from .py
//
data = {
    '2012-11-01': {'windows': 96.15, 'macos': 3.26, 'linux': 0.0},
    '2012-12-01': {'windows': 94.80, 'macos': 3.72, 'linux': 0.8},
    '2013-01-01': {'windows': 94.56, 'macos': 3.56, 'linux': 1.12},
    '2013-02-01': {'windows': 94.11, 'macos': 3.07, 'linux': 2.02},
    '2013-02-22': {'windows': 94.20, 'macos': 3.27, 'linux': 2.46},
    '2013-03-01': {'windows': 94.58, 'macos': 3.67, 'linux': 1.68},
    '2013-04-25': {'windows': 94.62, 'macos': 3.63, 'linux': 1.69},
    '2013-05-09': {'windows': 94.91, 'macos': 3.23, 'linux': 1.24},
    '2013-06-03': {'windows': 94.57, 'macos': 3.43, 'linux': 1.36},
    '2013-06-17': {'windows': 94.74, 'macos': 3.34, 'linux': 1.34},
    '2013-07-22': {'windows': 94.82, 'macos': 3.54, 'linux': 1.07},
    '2013-08-01': {'windows': 94.28, 'macos': 3.92, 'linux': 1.06},
    '2013-09-10': {'windows': 94.59, 'macos': 3.80, 'linux': 0.93}
}
//
//

var plot = {}
var format = d3.time.format("%Y-%m-%d");
for (keytime in data) {
    for (keyos in data[keytime]) {
        if (!(keyos in plot)) {
            plot[keyos] = [];
        }
        plot[keyos].push({
            'x': format.parse(keytime).getTime()/1000,
            'y': data[keytime][keyos],
        });
    }
}
var series = [];
for (os in plot) {
    series.push({
        name: os,
        data: plot[os],
        color: palette.color(),
    });
}

var graph = new Rickshaw.Graph({
    element: document.getElementById("chart"),
    width: 400,
    height: 240,
    renderer: 'line',
    series: series
});

var hoverDetail = new Rickshaw.Graph.HoverDetail({
    graph: graph
});

var legend = new Rickshaw.Graph.Legend({
    graph: graph,
    element: document.getElementById('legend')
});

var shelving = new Rickshaw.Graph.Behavior.Series.Toggle({
    graph: graph,
    legend: legend
});

var highlighter = new Rickshaw.Graph.Behavior.Series.Highlight({
    graph: graph,
    legend: legend
});

var x_axis = new Rickshaw.Graph.Axis.Time({ graph: graph });

var y_axis = new Rickshaw.Graph.Axis.Y({
    graph: graph,
    orientation: 'left',
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.getElementById('y_axis'),
});

var offsetForm = document.getElementById('offset_form');

offsetForm.addEventListener('change', function(e) {
    var offsetMode = e.target.value;

    if (offsetMode == 'lines') {
        graph.setRenderer('line');
        graph.offset = 'zero';
    } else {
        graph.setRenderer('stack');
        graph.offset = offsetMode;
    }
    graph.render();

}, false);

graph.render();

</script>
</body>
